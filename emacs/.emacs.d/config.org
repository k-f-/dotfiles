#+TITLE: Emacs Configuration
#+AUTHOR: Kyle Fring
#+EMAIL: me@kfring.com
#+OPTIONS: toc:nil num:nil

* Starting with literate emac's configuration.

#+BEGIN_SRC emacs-lisp
;; Not that we needed all that for the trip,
;; but once you get locked into a serious drug collection,
;; the tendency is to push it as far as you can.

;;       --- Hunter S. Thompson, Fear and Loathing in Las Vegas

;; --------------------------------------------------
;; Set global user
(setq user-full-name "Kyle Fring"
	  user-mail-address "me@kfring.com")
(setq calendar-location-name "Philadelphia, PA")
(setq calendar-latitude 39.95)
(setq calendar-longitude -75.16)

;; Create custom file elsewhere.
;; keep customize settings in their own file 
(setq custom-file "~/.emacs.d/custom.el")
(when (file-exists-p custom-file) (load custom-file))

;; --------------------------------------------------
;; User Interface
;; --------------------------------------------------
;; Don't display the help screen at start-up
(setq inhibit-startup-screen t)

;; --------------------------------------------------
;; Disable bell
(setq ring-bell-function 'ignore)

;; --------------------------------------------------
;; Minimal UI
(scroll-bar-mode -1)
(tool-bar-mode   -1)
(tooltip-mode    -1)
(menu-bar-mode   -1)

;; Time in modeline
(display-time-mode 1)

;; --------------------------------------------------
;; Fonts
;; --------------------------------------------------
;; Test char and monospace:
;; 0123456789abcdefghijklmnopqrstuvwxyz [] () :;,. !@#$^&*
;; 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ {} <> "'`  ~-_/|\?
;;(set-face-attribute 'default t :font "InputMono-12" )
(add-to-list 'default-frame-alist
             '(font . "InputMono-12"))

;; --------------------------------------------------
;; Backups
;; --------------------------------------------------
; Let us centralize where emac's keeps backups
(setq backup-directory-alist '(("." . "~/.emacs.d/backup"))
	backup-by-copying t    ; Don't delink hardlinks
	version-control t      ; Use version numbers on backups
	delete-old-versions t  ; Automatically delete excess backups
	kept-new-versions 20   ; how many of the newest versions to keep
	kept-old-versions 5    ; and how many of the old
	)

;; make backup to a designated dir, mirroring the full path
;; ala ergomacs
(defun kef-backup-file-name (fpath)
  "Return a new file path of a given file path.
If the new path's directories does not exist, create them."
  (let* (
		(backupRootDir "~/.emacs.d/backup/")
		(filePath (replace-regexp-in-string "[A-Za-z]:" "" fpath )) ; remove Windows driver letter in path, for example, “C:”
		(backupFilePath (replace-regexp-in-string "//" "/" (concat backupRootDir filePath "~") ))
		)
	(make-directory (file-name-directory backupFilePath) (file-name-directory backupFilePath))
	backupFilePath
  )
)

(setq make-backup-file-name-function 'kef-backup-file-name)

;; --------------------------------------------------
;; functions for auto-tangle after changes to config.org
;; -------------------------------------------------

;; Only want to tangle if we’ve just saved the Emacs config.org file, 
;; so let’s build a new function to check that before running tangle, and hook to that instead:

;; (defun kef-tangle-on-save-emacs-config-org-file()
;; (when (string= buffer-file-name (file-truename "~/.emacs.d/config.org"))
;; (org-babel-tangle)))

;; (add-hook ‘after-save-hook ‘kef-tangle-on-save-emacs-config-org-file)

;; --------------------------------------------------
;; Movement & Formatting
;; --------------------------------------------------

;; --------------------------------------------------
;; Page Down

;; Smooth scrolling means when you hit C-n to go to the next line
;; at the bottom of the page, instead of doing a page-down,
;; it shifts down by a single line. The margin means that
;; much space is kept between the cursor and the bottom of the buffer.

(setq scroll-margin 3
	  scroll-conservatively 101
	  scroll-up-aggressively 0.01
	  scroll-down-aggressively 0.01
	  scroll-preserve-screen-position t
	  auto-window-vscroll nil
	  hscroll-margin 5
	  hscroll-step 5)

;; --------------------------------------------------
;; Tabs as 4 spaces
(setq-default tab-width 4)
(setq-default tab-stop-list (list 4 8 12))

;; --------------------------------------------------
;; Packages
;; --------------------------------------------------
;; Package configs
(require 'package)
(setq package-enable-at-startup nil)
(setq package-archives '(("org"   . "http://orgmode.org/elpa/")
						 ("gnu"   . "http://elpa.gnu.org/packages/")
						 ("melpa" . "https://melpa.org/packages/")))
(package-initialize)

;; --------------------------------------------------
;; Bootstrap `use-package`
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

(setq use-package-verbose t)
(setq use-package-always-ensure t)
(setq use-package-always-defer t)
(require 'use-package)
;; --------------------------------------------------
;; Color Themes
;; apropospriate, nord, dracula
(use-package apropospriate-theme :ensure :defer)
(use-package dracula-theme :ensure :defer)

;; Packages
;; --------------------------------------------------
;; Enable Ido
(ido-mode t)

;; --------------------------------------------------
;; org-mode
;; --------------------------------------------------
(use-package org)
;; org files in dropbox
(setq org-agenda-files (list "~/Dropbox/org/work.org"
                             "~/Dropbox/org/life.org" ))
(add-to-list 'auto-mode-alist '("\\.\\(org\\|org_archive\\)$" . org-mode))

;; colorize src blocks in org-mode
(setq org-src-fontify-natively t)

;; org-mode auto save only
;;(add-hook 'org-mode-hook 'my-org-mode-autosave-settings)
;;(defun my-org-mode-autosave-settings ()
;;  (set (make-local-variable 'auto-save-visited-file-name) t)
;;  (setq auto-save-interval 20))

;; --------------------------------------------------
;; flyspell - in all text modes
(add-hook 'text-mode-hook 'flyspell-mode)

;; --------------------------------------------------
;; theme-changer
(use-package theme-changer)
(require 'theme-changer)
(change-theme 'apropospriate-light 'dracula)

;; --------------------------------------------------
;; Magit
(use-package magit)

;; --------------------------------------------------
;; Company
(use-package company)

;; --------------------------------------------------
(use-package org-pomodoro)

;; --------------------------------------------------
;; Deft
(use-package deft
  :bind ("<f8>" . deft)
  :commands (deft)
  :config (setq deft-directory "~/Dropbox/org/notes/"
				deft-extensions '("md" "org" "txt")))
(setq deft-default-extension "org")
(setq deft-use-filename-as-title nil)
(setq deft-use-filter-string-for-filename t)
(setq deft-file-naming-rules '((noslash . "-")
							   (nospace . "-")
							   (case-fn . downcase)))
(setq deft-text-mode 'org-mode)

;; filenames - replace space and slash with - lcase
(setq deft-file-naming-rules
	  '((noslash . "-")
		(nospace . "-")
		(case-fn . downcase)))

;; --------------------------------------------------
;; Deft-Mode custom functions via: http://pragmaticemacs.com/emacs/tweaking-deft-quicker-notes/
;; Custom function to save window-layout when launching deft-mode
;; advise deft to save window config

(defun kef-deft-save-windows (orig-fun &rest args)
  (setq kef-pre-deft-window-config (current-window-configuration))
  (apply orig-fun args)
  )

(advice-add 'deft :around #'kef-deft-save-windows)

;;function to quit a deft edit cleanly back to pre deft window
(defun kef-quit-deft ()
  "Save buffer, kill buffer, kill deft buffer, and restore window config to the way it was before deft was invoked"
  (interactive)
  (save-buffer)
  (kill-this-buffer)
  (switch-to-buffer "*Deft*")
  (kill-this-buffer)
  (when (window-configuration-p kef-pre-deft-window-config)
    (set-window-configuration kef-pre-deft-window-config)
    )
  )

(global-set-key (kbd "C-c q") 'kef-quit-deft)

;; with-editor: Use local Emacs instance as $EDITOR (e.g. in `git commit’ or `crontab -e’)
(use-package with-editor :ensure :defer
  ;; Use local Emacs instance as $EDITOR (e.g. in `git commit' or `crontab -e')
  :hook ((shell-mode eshell-mode term-exec) . with-editor-export-editor))

;; undo-tree
(use-package undo-tree)

(add-to-list 'load-path "~/.emacs.d/undo-tree")
(global-undo-tree-mode)
#+END_SRC

#+RESULTS:
: t

* Configure =use-package=
